---
layout: default
title: Git使用手册
author: lijiaocn
createdate: 2017/04/01 11:00:33
changedate: 2017/11/23 20:13:24
categories: 技巧
tags: git
keywords: git
description: git的使用手册，常用的协作方法，和一些非常有用的小技巧。

---

* auto-gen TOC:
{:toc}

## 摘要

Git的操作经常忘记, 这里记录下常用的操作。

可以参考beego的项目管理：

![git project]({{ site.imglocal }}/git/01project.png )

## 设置代理

有一些项目使用了自己的git服务器，因为“墙”的存在，从国内访问这些git服务的时候，需要通过能够翻墙的代理。

可以设置为全局的：

	git config --global http.proxy 127.0.0.1:49710
	git config --global https.proxy 127.0.0.1:49710
	git config --global http.sslverify false 

git的全局配置文件是`~/.gitconfig`:

	[http]
		proxy = 127.0.0.1:49710
		sslverify = false
	[https]
		proxy = 127.0.0.1:49710

不需要代理的时候，可以用#号注释掉。

将repo获取到以后，可以在repo里设置local config，只在当前repo中使用代理:

	git config --local http.proxy 127.0.0.1:49710
	git config --local https.proxy 127.0.0.1:49710
	git config --local http.sslverify false 

## github协作开发

第一步，在github上fork目标项目。

第二步，将fork到自己账户中项目代码clone到本地。

第三步，在本地添加上游代码的索引，这里命名为upstream：

	git remote add upstream  https://github.com/kubernetes/kubernetes

第四步，在本地开始开发工作，本地的开发过程参考下一节“[在分支中开发][4]”。

第五步，获取上游代码的更新，注意upstream是上游代码的索引:

	git remote update upstream

第六步，将本地分支设置为基于最新的上游代码：

	git rebase upstream/master  (将当前所在分支的设置为基于upstream/master)
	
	git rebase upstream/branchX  branchL  (将本地branchL分支的修改设置为基于upstream/branchX) 

第七步，将本地的修改提交到自己的repo中。

第八步，在github上发起pull request。

## github中发布版本

创建一个发布分支：

	git branch release-v1.8.0

将发布分支推送到远端：

	git push origin release-v1.8.0:release-v1.8.0

在项目的github主页上，点击release，进行发布，注意在分支上进行release。

如果要删除release，只需要在本地和远端删除对应的tag即可。[Git: 删除tag][5]

## 在分支中开发

[Merging vs Rebasing-zh][2]([Merging vs Rebasing-en][3])中给出特别详细的说明。

第一步，获取master代码:

	git checkout master

第二步，本地创建开发分支:

	git checkout -b dev-branch

第三步，本地开发完成后，提交开发分支中的内容:

	git add .
	
	git status
	
	git commit --verbose  

注意：切换到其它的分支之前一定要先commit,否则其它分支中的内容会受影响。

可以将多个commit合并为一个commit，见“合并commit”一节。

将本次的commit合并到上一次commit，可以使用“--amend”选项

第四步，如果其他人员也参与这个分支的开发，将本地分支推送到远端：

	git push origin local_branch:remote_branch  

第五步，将远端的更新下载到本地:

	git fetch origin

第六步，将本地开发分支的内容设置为基于最新的的master代码:

	git rebase master dev-branch

这个过程会有多次冲突，必须一个一个地解决！然后继续rebase:

	git rebase master --continue

如果开发分支是基于另一个分支的，也可以将其修改为基于master分支:

	git rebase -onto master  anotherbranch  currunbranch

第七步，在master中合并已经做过rebase的开发分支，注意是merge！

	git merge dev-branch

或者在github页面中发起pull request，请求将开发分支中的内容合并到master。

第八步，在master中完成commit、push、打tag：

	git add .
	
	git status
	
	git commit
	
	git push

标记tag:

	git tag v0.0.X
	git push origin v0.0.X

第九步，删除本地开发分支和远端的开发分支：

	git branch -d dev-branch
	git push origin :dev-branch 

## 常用git操作

### 合并commit

从log中找到一个在要合并的分支之前的commit(ffe)

在rebase中设置要合并的commit

	git rebase -i ffe

编辑界面如下(将7143, 2a7c合并到ffe39):

	 pick ffe398c d1
	
	 s 2a7ccaa d2+d3
	
	 s 714ef1b d4 amend

越靠前的commit越老, 将一个commit前面的pick修改为s, 表示这个commit将和它前面的commit合并为一个commit

保存、推出编辑后，如果存在合并的commit，会立即弹出问本次合并填写注释的编辑窗口,编写新的注释后推出即可

退出注释编辑窗口后，ffe,2a7,714消失, 被一个新的commit取代。

### 回退

git reset:

	git reset --soft:   只将HEAD移动到指定的commit, 不会改动index文件和工作目录
	
	git reset --mixed 或者 git reset:   index文件回退到指定的commit, 不改动工作目录
	
	git reset --hard:  index文件和工作目录都回退到指定的commit

git rm之后，还没有提交:

	git reset HEAD <删除的文件或目录>
	git checkout <删除的文件或目录>

删除commit:

	git reset --hard <commit_id>
    git push origin HEAD --force

### 查看/拉取远程分支

查看:

	git branch -r 

拉取远程分支:

	git checkout -b 本地分支名 -t 远程分支名

### 推送分支

	git push origin 本地分支:远程分支

### 删除远程分支

	git push origin :远程分支

### 推送tag

	git push origin TagName   //推送指定tag
	git push origin --tags    //推送全部tag

### 删除tag

	git tag -d TagName        //删除本地tag
	git push origin :TagName  //删除远程tag

### 永久删除

[https://help.github.com/articles/remove-sensitive-data/](https://help.github.com/articles/remove-sensitive-data/)

[http://zpz.name/2287/](http://zpz.name/2287/)

	git filter-branch --index-filter 'git rm -r --cached --ignore-unmatch path/to/your/file' HEAD
	git push origin master --force
	rm -rf .git/refs/original/
	git reflog expire --expire=now --all
	git gc --prune=now
	git gc --aggressive --prune=now''

### 配置编辑器

	git config --global core.editor vim

### 代码对比

展示commit2相对于commit1发生的改动：

	 git diff  commit1  commit2

## 常见问题解决

### 中文名乱码

解决中文文件名显示乱码：

	git config core.quotepath false

## 参考

1. [undo git rm][1]
2. [Merging vs Rebasing-zh][2]
3. [Merging vs Rebasing-en][3]
4. [Git: 在分支中开发][4]
5. [Git: 删除tag][5]

[1]: https://stackoverflow.com/questions/25311743/undo-git-rm-r-cached  "undo git rm -r"
[2]: http://www.cnblogs.com/itech/p/5188932.html   "Merging vs Rebasing zh"
[3]: https://www.atlassian.com/git/tutorials/merging-vs-rebasing  "Merging vs Rebasing en"
[4]: http://www.lijiaocn.com/%E6%8A%80%E5%B7%A7/2017/04/01/git.html#在分支中开发 "Git: 在分支中开发"
[5]: http://www.lijiaocn.com/%E6%8A%80%E5%B7%A7/2017/04/01/git.html#删除tag  "Git: 删除tag"
